<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DungeonCrawl: src/database/game/gamestate_database.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DungeonCrawl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('gamestate__database_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">gamestate_database.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements functionality to work with the gamestate and database.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="gamestate__database_8h_source.html">gamestate_database.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logger_8h_source.html">../../logging/logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="database_8h_source.html">../database.h</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
</div>
<p><a href="gamestate__database_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aa62433a7807cf7f0bc9cf3f8323ba80c" id="r_aa62433a7807cf7f0bc9cf3f8323ba80c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa62433a7807cf7f0bc9cf3f8323ba80c">TIMESTAMP_FORMAT</a>&#160;&#160;&#160;&quot;%Y-%m-%d %H:%M:%S&quot;</td></tr>
<tr class="memitem:a0f5d40337f5da092b868d40bcafa5ad3" id="r_a0f5d40337f5da092b868d40bcafa5ad3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0f5d40337f5da092b868d40bcafa5ad3">SQL_INSERT_GAME_STATE</a>&#160;&#160;&#160;&quot;INSERT INTO game_state (GS_SAVEDTIME, GS_NAME) VALUES (?, ?)&quot;</td></tr>
<tr class="memitem:ad64a4dbbc206e1ae73576eeface89d88" id="r_ad64a4dbbc206e1ae73576eeface89d88"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad64a4dbbc206e1ae73576eeface89d88">SQL_INSERT_MAP_STATE</a>&#160;&#160;&#160;&quot;INSERT INTO map_state (MS_MAP, MS_REVEALED, MS_HEIGHT,MS_WIDTH, MS_GS_ID) VALUES (?, ?, ?, ?, ?)&quot;</td></tr>
<tr class="memitem:a66be03618752f92cb8a5748b57c1b105" id="r_a66be03618752f92cb8a5748b57c1b105"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a66be03618752f92cb8a5748b57c1b105">SQL_INSERT_PLAYER_STATE</a>&#160;&#160;&#160;&quot;INSERT INTO player_state (PS_X, PS_Y, PS_GS_ID) VALUES (?, ?, ?)&quot;</td></tr>
<tr class="memitem:a468fb0895fad7651f7380cca20ac7813" id="r_a468fb0895fad7651f7380cca20ac7813"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a468fb0895fad7651f7380cca20ac7813">SQL_SELECT_LAST_GAME_STATE</a>&#160;&#160;&#160;&quot;SELECT GS_ID FROM game_state ORDER BY GS_SAVEDTIME DESC LIMIT 1&quot;</td></tr>
<tr class="memitem:a568202f9b39f2d647b9c495598e28af7" id="r_a568202f9b39f2d647b9c495598e28af7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a568202f9b39f2d647b9c495598e28af7">SQL_SELECT_MAP_STATE</a>&#160;&#160;&#160;&quot;SELECT MS_HEIGHT, MS_WIDTH FROM map_state WHERE MS_GS_ID = ?&quot;</td></tr>
<tr class="memitem:a81e8fcf0e399b80732ab7c64fb2b7987" id="r_a81e8fcf0e399b80732ab7c64fb2b7987"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a81e8fcf0e399b80732ab7c64fb2b7987">SQL_SELECT_MAP</a>&#160;&#160;&#160;&quot;SELECT value FROM map_state, json_each(map_state.MS_MAP) WHERE MS_GS_ID = ?&quot;</td></tr>
<tr class="memitem:aa63475cdf1317a51db2713df0f7ed8c9" id="r_aa63475cdf1317a51db2713df0f7ed8c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa63475cdf1317a51db2713df0f7ed8c9">SQL_SELECT_REVEALED_MAP</a>&#160;&#160;&#160;&quot;SELECT value FROM map_state, json_each(map_state.MS_REVEALED) WHERE MS_GS_ID = ?&quot;</td></tr>
<tr class="memitem:ad809cd1396624aff7e90c941dd6c3ce1" id="r_ad809cd1396624aff7e90c941dd6c3ce1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad809cd1396624aff7e90c941dd6c3ce1">SQL_SELECT_PLAYER_STATE</a>&#160;&#160;&#160;&quot;SELECT PS_X, PS_Y FROM player_state WHERE PS_GS_ID = ?&quot;</td></tr>
<tr class="memitem:a66e1bb6b6f486f979267809ee5291c19" id="r_a66e1bb6b6f486f979267809ee5291c19"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a66e1bb6b6f486f979267809ee5291c19">SQL_SELECT_ALL_GAME_STATES</a>&#160;&#160;&#160;&quot;SELECT GS_ID, GS_SAVEDTIME, GS_NAME FROM game_state ORDER BY GS_SAVEDTIME DESC&quot;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa85bcfad6111a8ba703fa55a8b8ff20e" id="r_aa85bcfad6111a8ba703fa55a8b8ff20e"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa85bcfad6111a8ba703fa55a8b8ff20e">get_iso8601_time</a> ()</td></tr>
<tr class="memdesc:aa85bcfad6111a8ba703fa55a8b8ff20e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current time in ISO 8601 format.  <br /></td></tr>
<tr class="memitem:a5939eebd6fcb052e5b1b2465bb97ee42" id="r_a5939eebd6fcb052e5b1b2465bb97ee42"><td class="memItemLeft" align="right" valign="top">sqlite_int64&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5939eebd6fcb052e5b1b2465bb97ee42">save_game_state</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection, const int *map, const int *revealed_map, const int width, const int height, const <a class="el" href="structvector2d__t.html">vector2d_t</a> player, const char *save_name)</td></tr>
<tr class="memdesc:a5939eebd6fcb052e5b1b2465bb97ee42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save the game state.  <br /></td></tr>
<tr class="memitem:aa55051e28e3b3b3fba26bfe29c3222a1" id="r_aa55051e28e3b3b3fba26bfe29c3222a1"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa55051e28e3b3b3fba26bfe29c3222a1">arr2D_to_flat_json</a> (const int *arr, const int width, const int height)</td></tr>
<tr class="memdesc:aa55051e28e3b3b3fba26bfe29c3222a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a 2D array to a Json-Array.  <br /></td></tr>
<tr class="memitem:a66a9ad4ea78ce3c63bd7399e7445f5e1" id="r_a66a9ad4ea78ce3c63bd7399e7445f5e1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a66a9ad4ea78ce3c63bd7399e7445f5e1">get_game_state</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection, int *map, int *revealed_map, const int width, const int height, const player_pos_setter_t setter)</td></tr>
<tr class="memdesc:a66a9ad4ea78ce3c63bd7399e7445f5e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the game state from the database.  <br /></td></tr>
<tr class="memitem:ab2f4a1908e3962130626a23d00711e39" id="r_ab2f4a1908e3962130626a23d00711e39"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab2f4a1908e3962130626a23d00711e39">get_game_state_by_id</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection, const int game_state_id, int *map, int *revealed_map, const int width, const int height, const player_pos_setter_t setter)</td></tr>
<tr class="memdesc:ab2f4a1908e3962130626a23d00711e39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the game state for a specific id from the database.  <br /></td></tr>
<tr class="memitem:ae37f61a14d87006756eb5c503b8934c2" id="r_ae37f61a14d87006756eb5c503b8934c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structsave__info__container__t.html">save_info_container_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae37f61a14d87006756eb5c503b8934c2">get_save_infos</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection)</td></tr>
<tr class="memdesc:ae37f61a14d87006756eb5c503b8934c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the info of the saves.  <br /></td></tr>
<tr class="memitem:aed834a6e5c0e9ae62c5914d52cd21578" id="r_aed834a6e5c0e9ae62c5914d52cd21578"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aed834a6e5c0e9ae62c5914d52cd21578">free_save_infos</a> (<a class="el" href="structsave__info__container__t.html">save_info_container_t</a> *save_infos)</td></tr>
<tr class="memdesc:aed834a6e5c0e9ae62c5914d52cd21578"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the resources associated with a save_info_container.  <br /></td></tr>
<tr class="memitem:a17208216d45a99fd57793a6bf795d3f8" id="r_a17208216d45a99fd57793a6bf795d3f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a17208216d45a99fd57793a6bf795d3f8">create_tables_game_state</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection)</td></tr>
<tr class="memdesc:a17208216d45a99fd57793a6bf795d3f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the tables for the game state.  <br /></td></tr>
<tr class="memitem:aa93a439080a0ddfe9baed9d95c87db8d" id="r_aa93a439080a0ddfe9baed9d95c87db8d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa93a439080a0ddfe9baed9d95c87db8d">get_latest_save_id</a> (const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *db_connection)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements functionality to work with the gamestate and database. </p>

<p class="definition">Definition in file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a0f5d40337f5da092b868d40bcafa5ad3" name="a0f5d40337f5da092b868d40bcafa5ad3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f5d40337f5da092b868d40bcafa5ad3">&#9670;&#160;</a></span>SQL_INSERT_GAME_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_INSERT_GAME_STATE&#160;&#160;&#160;&quot;INSERT INTO game_state (GS_SAVEDTIME, GS_NAME) VALUES (?, ?)&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00018">18</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="ad64a4dbbc206e1ae73576eeface89d88" name="ad64a4dbbc206e1ae73576eeface89d88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad64a4dbbc206e1ae73576eeface89d88">&#9670;&#160;</a></span>SQL_INSERT_MAP_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_INSERT_MAP_STATE&#160;&#160;&#160;&quot;INSERT INTO map_state (MS_MAP, MS_REVEALED, MS_HEIGHT,MS_WIDTH, MS_GS_ID) VALUES (?, ?, ?, ?, ?)&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00019">19</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="a66be03618752f92cb8a5748b57c1b105" name="a66be03618752f92cb8a5748b57c1b105"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66be03618752f92cb8a5748b57c1b105">&#9670;&#160;</a></span>SQL_INSERT_PLAYER_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_INSERT_PLAYER_STATE&#160;&#160;&#160;&quot;INSERT INTO player_state (PS_X, PS_Y, PS_GS_ID) VALUES (?, ?, ?)&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00020">20</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="a66e1bb6b6f486f979267809ee5291c19" name="a66e1bb6b6f486f979267809ee5291c19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66e1bb6b6f486f979267809ee5291c19">&#9670;&#160;</a></span>SQL_SELECT_ALL_GAME_STATES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_ALL_GAME_STATES&#160;&#160;&#160;&quot;SELECT GS_ID, GS_SAVEDTIME, GS_NAME FROM game_state ORDER BY GS_SAVEDTIME DESC&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00026">26</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="a468fb0895fad7651f7380cca20ac7813" name="a468fb0895fad7651f7380cca20ac7813"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a468fb0895fad7651f7380cca20ac7813">&#9670;&#160;</a></span>SQL_SELECT_LAST_GAME_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_LAST_GAME_STATE&#160;&#160;&#160;&quot;SELECT GS_ID FROM game_state ORDER BY GS_SAVEDTIME DESC LIMIT 1&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00021">21</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="a81e8fcf0e399b80732ab7c64fb2b7987" name="a81e8fcf0e399b80732ab7c64fb2b7987"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81e8fcf0e399b80732ab7c64fb2b7987">&#9670;&#160;</a></span>SQL_SELECT_MAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_MAP&#160;&#160;&#160;&quot;SELECT value FROM map_state, json_each(map_state.MS_MAP) WHERE MS_GS_ID = ?&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00023">23</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="a568202f9b39f2d647b9c495598e28af7" name="a568202f9b39f2d647b9c495598e28af7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a568202f9b39f2d647b9c495598e28af7">&#9670;&#160;</a></span>SQL_SELECT_MAP_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_MAP_STATE&#160;&#160;&#160;&quot;SELECT MS_HEIGHT, MS_WIDTH FROM map_state WHERE MS_GS_ID = ?&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00022">22</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="ad809cd1396624aff7e90c941dd6c3ce1" name="ad809cd1396624aff7e90c941dd6c3ce1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad809cd1396624aff7e90c941dd6c3ce1">&#9670;&#160;</a></span>SQL_SELECT_PLAYER_STATE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_PLAYER_STATE&#160;&#160;&#160;&quot;SELECT PS_X, PS_Y FROM player_state WHERE PS_GS_ID = ?&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00025">25</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="aa63475cdf1317a51db2713df0f7ed8c9" name="aa63475cdf1317a51db2713df0f7ed8c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa63475cdf1317a51db2713df0f7ed8c9">&#9670;&#160;</a></span>SQL_SELECT_REVEALED_MAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SQL_SELECT_REVEALED_MAP&#160;&#160;&#160;&quot;SELECT value FROM map_state, json_each(map_state.MS_REVEALED) WHERE MS_GS_ID = ?&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00024">24</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a id="aa62433a7807cf7f0bc9cf3f8323ba80c" name="aa62433a7807cf7f0bc9cf3f8323ba80c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa62433a7807cf7f0bc9cf3f8323ba80c">&#9670;&#160;</a></span>TIMESTAMP_FORMAT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMESTAMP_FORMAT&#160;&#160;&#160;&quot;%Y-%m-%d %H:%M:%S&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00016">16</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="aa55051e28e3b3b3fba26bfe29c3222a1" name="aa55051e28e3b3b3fba26bfe29c3222a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa55051e28e3b3b3fba26bfe29c3222a1">&#9670;&#160;</a></span>arr2D_to_flat_json()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * arr2D_to_flat_json </td>
          <td>(</td>
          <td class="paramtype">const int *</td>          <td class="paramname"><span class="paramname"><em>arr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a 2D array to a Json-Array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arr</td><td>The given array to convert to a Json-Array </td></tr>
    <tr><td class="paramname">width</td><td>The width of the array </td></tr>
    <tr><td class="paramname">height</td><td>The height of the array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The Json-Array as a string (must be freed by the caller), NULL if a malloc error occurred </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The returned string is a flattened JSON Array (e.g. [[1,2],[3,4]] -&gt; [1,2,3,4]) </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00203">203</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  203</span>                                                                            {</div>
<div class="line"><span class="lineno">  204</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> buffer_size = width * height * 12 + 2;<span class="comment">// 16 is a safe estimate for int size + comma + space</span></div>
<div class="line"><span class="lineno">  205</span>    <span class="keywordtype">char</span>* json = malloc(buffer_size);</div>
<div class="line"><span class="lineno">  206</span>    <span class="keywordflow">if</span> (json == NULL) {</div>
<div class="line"><span class="lineno">  207</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for JSON string&quot;</span>);</div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  209</span>    }</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    strcpy(json, <span class="stringliteral">&quot;[&quot;</span>);</div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> total_elements = width * height;</div>
<div class="line"><span class="lineno">  214</span>    <span class="comment">// Loop over the 2D map and append each element in a 1D fashion</span></div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; total_elements; i++) {</div>
<div class="line"><span class="lineno">  216</span>        <span class="keywordtype">char</span> number[10];<span class="comment">// Buffer to hold the number as a string</span></div>
<div class="line"><span class="lineno">  217</span>        <span class="comment">// Write the value into the buffer</span></div>
<div class="line"><span class="lineno">  218</span>        snprintf(number, <span class="keyword">sizeof</span>(number), <span class="stringliteral">&quot;%d&quot;</span>, arr[i]);</div>
<div class="line"><span class="lineno">  219</span>        strcat(json, number);<span class="comment">// Append the number to the JSON string</span></div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>        <span class="comment">// If it&#39;s not the last element, append a comma</span></div>
<div class="line"><span class="lineno">  222</span>        <span class="keywordflow">if</span> (i &lt; total_elements - 1) {</div>
<div class="line"><span class="lineno">  223</span>            strcat(json, <span class="stringliteral">&quot;,&quot;</span>);</div>
<div class="line"><span class="lineno">  224</span>        }</div>
<div class="line"><span class="lineno">  225</span>    }</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>    strcat(json, <span class="stringliteral">&quot;]&quot;</span>);<span class="comment">//strcat always ensures that the string is null-terminated</span></div>
<div class="line"><span class="lineno">  228</span>    <span class="keywordflow">return</span> json;</div>
<div class="line"><span class="lineno">  229</span>}</div>
<div class="ttc" id="alogger_8c_html_aa70df4f70b7969a40b70fda659005550"><div class="ttname"><a href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a></div><div class="ttdeci">void log_msg(const log_level_t level, const char *module, const char *format,...)</div><div class="ttdoc">Logs a formatted message with a specified log level and module.</div><div class="ttdef"><b>Definition</b> <a href="logger_8c_source.html#l00246">logger.c:246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a17208216d45a99fd57793a6bf795d3f8" name="a17208216d45a99fd57793a6bf795d3f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17208216d45a99fd57793a6bf795d3f8">&#9670;&#160;</a></span>create_tables_game_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_tables_game_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the tables for the game state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>The database connection </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The tables will be created if they do not exist </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00430">430</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  430</span>                                                                    {</div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="database_8c.html#a064257e61ac38087e12fb9b950289768">db_is_open</a>(db_connection)) {</div>
<div class="line"><span class="lineno">  432</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Database is not open&quot;</span>);</div>
<div class="line"><span class="lineno">  433</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  434</span>    }</div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>    <span class="comment">//Create GS table</span></div>
<div class="line"><span class="lineno">  437</span>    sqlite3_stmt* stmt;</div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordtype">int</span> rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_CREATE_TABLES_GAMESTATE_GS, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  440</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  441</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  442</span>    }</div>
<div class="line"><span class="lineno">  443</span>    rc = sqlite3_step(stmt);</div>
<div class="line"><span class="lineno">  444</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">  445</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  446</span>    }</div>
<div class="line"><span class="lineno">  447</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>    <span class="comment">// Create MS table</span></div>
<div class="line"><span class="lineno">  450</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_CREATE_TABLES_GAMESTATE_MS, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">  451</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  452</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  453</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  454</span>    }</div>
<div class="line"><span class="lineno">  455</span>    rc = sqlite3_step(stmt);</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">  457</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  458</span>    }</div>
<div class="line"><span class="lineno">  459</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="comment">// Create PS table</span></div>
<div class="line"><span class="lineno">  462</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_CREATE_TABLES_GAMESTATE_PS, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">  463</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  464</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  465</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  466</span>    }</div>
<div class="line"><span class="lineno">  467</span>    rc = sqlite3_step(stmt);</div>
<div class="line"><span class="lineno">  468</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">  469</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  470</span>    }</div>
<div class="line"><span class="lineno">  471</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  472</span>}</div>
<div class="ttc" id="adatabase_8c_html_a064257e61ac38087e12fb9b950289768"><div class="ttname"><a href="database_8c.html#a064257e61ac38087e12fb9b950289768">db_is_open</a></div><div class="ttdeci">int db_is_open(const db_connection_t *db_connection)</div><div class="ttdoc">This function is to check if the database is open.</div><div class="ttdef"><b>Definition</b> <a href="database_8c_source.html#l00027">database.c:27</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed834a6e5c0e9ae62c5914d52cd21578" name="aed834a6e5c0e9ae62c5914d52cd21578"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed834a6e5c0e9ae62c5914d52cd21578">&#9670;&#160;</a></span>free_save_infos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_save_infos </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsave__info__container__t.html">save_info_container_t</a> *</td>          <td class="paramname"><span class="paramname"><em>save_infos</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free the resources associated with a save_info_container. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">save_infos</td><td>Save info to free. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00421">421</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  421</span>                                                        {</div>
<div class="line"><span class="lineno">  422</span>    <span class="keywordflow">if</span> (save_infos == NULL) {</div>
<div class="line"><span class="lineno">  423</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  424</span>    }</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    free(save_infos-&gt;infos);</div>
<div class="line"><span class="lineno">  427</span>    free(save_infos);</div>
<div class="line"><span class="lineno">  428</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a66a9ad4ea78ce3c63bd7399e7445f5e1" name="a66a9ad4ea78ce3c63bd7399e7445f5e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66a9ad4ea78ce3c63bd7399e7445f5e1">&#9670;&#160;</a></span>get_game_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_game_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>revealed_map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">player_pos_setter_t</td>          <td class="paramname"><span class="paramname"><em>setter</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the game state from the database. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>A database connection. </td></tr>
    <tr><td class="paramname">map</td><td>Pointer to the map to load into. </td></tr>
    <tr><td class="paramname">revealed_map</td><td>Pointer to the revealed map to load into. </td></tr>
    <tr><td class="paramname">width</td><td>Width of the map. </td></tr>
    <tr><td class="paramname">height</td><td>Hieght of the map. </td></tr>
    <tr><td class="paramname">setter</td><td>A setter for the player position. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success none 0 on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00231">231</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  231</span>                                                                                                                                                           {</div>
<div class="line"><span class="lineno">  232</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="#ab2f4a1908e3962130626a23d00711e39">get_game_state_by_id</a>(db_connection, <a class="code hl_function" href="#aa93a439080a0ddfe9baed9d95c87db8d">get_latest_save_id</a>(db_connection), map, revealed_map, width, height, setter);</div>
<div class="line"><span class="lineno">  233</span>}</div>
<div class="ttc" id="agamestate__database_8c_html_aa93a439080a0ddfe9baed9d95c87db8d"><div class="ttname"><a href="#aa93a439080a0ddfe9baed9d95c87db8d">get_latest_save_id</a></div><div class="ttdeci">int get_latest_save_id(const db_connection_t *db_connection)</div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8c_source.html#l00474">gamestate_database.c:474</a></div></div>
<div class="ttc" id="agamestate__database_8c_html_ab2f4a1908e3962130626a23d00711e39"><div class="ttname"><a href="#ab2f4a1908e3962130626a23d00711e39">get_game_state_by_id</a></div><div class="ttdeci">int get_game_state_by_id(const db_connection_t *db_connection, const int game_state_id, int *map, int *revealed_map, const int width, const int height, const player_pos_setter_t setter)</div><div class="ttdoc">Load the game state for a specific id from the database.</div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8c_source.html#l00235">gamestate_database.c:235</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab2f4a1908e3962130626a23d00711e39" name="ab2f4a1908e3962130626a23d00711e39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2f4a1908e3962130626a23d00711e39">&#9670;&#160;</a></span>get_game_state_by_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_game_state_by_id </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>game_state_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *</td>          <td class="paramname"><span class="paramname"><em>revealed_map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">player_pos_setter_t</td>          <td class="paramname"><span class="paramname"><em>setter</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load the game state for a specific id from the database. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>A database connection. </td></tr>
    <tr><td class="paramname">game_state_id</td><td>The id of the game state to be loaded. </td></tr>
    <tr><td class="paramname">map</td><td>Pointer to the map to load into. </td></tr>
    <tr><td class="paramname">revealed_map</td><td>Pointer to the revealed map to load into. </td></tr>
    <tr><td class="paramname">width</td><td>Width of the map. </td></tr>
    <tr><td class="paramname">height</td><td>Hieght of the map. </td></tr>
    <tr><td class="paramname">setter</td><td>A setter for the player position. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success none 0 on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00235">235</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  235</span>                                                                                                                                                                                          {</div>
<div class="line"><span class="lineno">  236</span>    <span class="comment">// Get the height and width from the database</span></div>
<div class="line"><span class="lineno">  237</span>    sqlite3_stmt* stmt_map;</div>
<div class="line"><span class="lineno">  238</span>    <span class="keywordtype">int</span> rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_MAP_STATE, -1, &amp;stmt_map, NULL);</div>
<div class="line"><span class="lineno">  239</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  240</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  241</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  242</span>    }</div>
<div class="line"><span class="lineno">  243</span>    <span class="comment">// Bind the game state ID to the statement</span></div>
<div class="line"><span class="lineno">  244</span>    rc = sqlite3_bind_int64(stmt_map, 1, game_state_id);</div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  246</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  247</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  248</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  249</span>    }</div>
<div class="line"><span class="lineno">  250</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  251</span>    rc = sqlite3_step(stmt_map);</div>
<div class="line"><span class="lineno">  252</span>    <span class="keywordflow">if</span> (rc != SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  253</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  254</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  255</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  256</span>    }</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>    sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  259</span> </div>
<div class="line"><span class="lineno">  260</span>    <span class="comment">//Get the map from the database</span></div>
<div class="line"><span class="lineno">  261</span>    sqlite3_stmt* stmt_map_data;</div>
<div class="line"><span class="lineno">  262</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_MAP, -1, &amp;stmt_map_data, NULL);</div>
<div class="line"><span class="lineno">  263</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  264</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  265</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  266</span>    }</div>
<div class="line"><span class="lineno">  267</span>    <span class="comment">// Bind the game state ID to the statement</span></div>
<div class="line"><span class="lineno">  268</span>    rc = sqlite3_bind_int64(stmt_map_data, 1, game_state_id);</div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  270</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  271</span>        sqlite3_finalize(stmt_map_data);</div>
<div class="line"><span class="lineno">  272</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  273</span>    }</div>
<div class="line"><span class="lineno">  274</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  275</span>    rc = sqlite3_step(stmt_map_data);</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">if</span> (rc != SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  277</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  278</span>        sqlite3_finalize(stmt_map_data);</div>
<div class="line"><span class="lineno">  279</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  280</span>    }</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><span class="lineno">  283</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> total_cells = width * height;</div>
<div class="line"><span class="lineno">  284</span>    <span class="keywordflow">while</span> (index &lt; total_cells &amp;&amp; rc == SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  285</span>        map[index] = sqlite3_column_int(stmt_map_data, 0);</div>
<div class="line"><span class="lineno">  286</span>        index++;</div>
<div class="line"><span class="lineno">  287</span>        rc = sqlite3_step(stmt_map_data);</div>
<div class="line"><span class="lineno">  288</span>    }</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>    <span class="keywordflow">if</span> (index != total_cells) {</div>
<div class="line"><span class="lineno">  291</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Didn&#39;t get all map data. Expected %d, got %d&quot;</span>, total_cells, index);</div>
<div class="line"><span class="lineno">  292</span>        sqlite3_finalize(stmt_map_data);</div>
<div class="line"><span class="lineno">  293</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  294</span>    }</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    sqlite3_finalize(stmt_map_data);</div>
<div class="line"><span class="lineno">  297</span> </div>
<div class="line"><span class="lineno">  298</span>    <span class="comment">//Get the revealed map from the database</span></div>
<div class="line"><span class="lineno">  299</span>    sqlite3_stmt* stmt_revealed_map_data;</div>
<div class="line"><span class="lineno">  300</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_REVEALED_MAP, -1, &amp;stmt_revealed_map_data, NULL);</div>
<div class="line"><span class="lineno">  301</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  302</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  303</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  304</span>    }</div>
<div class="line"><span class="lineno">  305</span>    <span class="comment">// Bind the game state ID to the statement</span></div>
<div class="line"><span class="lineno">  306</span>    rc = sqlite3_bind_int64(stmt_revealed_map_data, 1, game_state_id);</div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  308</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  309</span>        sqlite3_finalize(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  310</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  311</span>    }</div>
<div class="line"><span class="lineno">  312</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  313</span>    rc = sqlite3_step(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordflow">if</span> (rc != SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  315</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  316</span>        sqlite3_finalize(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  318</span>    }</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>    <span class="comment">// Build the revealed map from the result</span></div>
<div class="line"><span class="lineno">  321</span>    index = 0;</div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">while</span> (index &lt; total_cells &amp;&amp; rc == SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  323</span>        revealed_map[index] = sqlite3_column_int(stmt_revealed_map_data, 0);</div>
<div class="line"><span class="lineno">  324</span>        index++;</div>
<div class="line"><span class="lineno">  325</span>        rc = sqlite3_step(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  326</span>    }</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordflow">if</span> (index != total_cells) {</div>
<div class="line"><span class="lineno">  329</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Didn&#39;t get all revealed map data. Expected %d, got %d&quot;</span>, total_cells, index);</div>
<div class="line"><span class="lineno">  330</span>        sqlite3_finalize(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  331</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  332</span>    }</div>
<div class="line"><span class="lineno">  333</span> </div>
<div class="line"><span class="lineno">  334</span>    sqlite3_finalize(stmt_revealed_map_data);</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>    <span class="comment">//Get the player position from the database</span></div>
<div class="line"><span class="lineno">  337</span>    sqlite3_stmt* stmt_player_data;</div>
<div class="line"><span class="lineno">  338</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_PLAYER_STATE, -1, &amp;stmt_player_data, NULL);</div>
<div class="line"><span class="lineno">  339</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  340</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  341</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  342</span>    }</div>
<div class="line"><span class="lineno">  343</span>    <span class="comment">// Bind the game state ID to the statement</span></div>
<div class="line"><span class="lineno">  344</span>    rc = sqlite3_bind_int64(stmt_player_data, 1, game_state_id);</div>
<div class="line"><span class="lineno">  345</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  346</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  347</span>        sqlite3_finalize(stmt_player_data);</div>
<div class="line"><span class="lineno">  348</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  349</span>    }</div>
<div class="line"><span class="lineno">  350</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  351</span>    rc = sqlite3_step(stmt_player_data);</div>
<div class="line"><span class="lineno">  352</span>    <span class="keywordflow">if</span> (rc != SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  353</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  354</span>        sqlite3_finalize(stmt_player_data);</div>
<div class="line"><span class="lineno">  355</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  356</span>    }</div>
<div class="line"><span class="lineno">  357</span>    <span class="comment">// Get the player position from the result</span></div>
<div class="line"><span class="lineno">  358</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> player_x = sqlite3_column_int(stmt_player_data, 0);</div>
<div class="line"><span class="lineno">  359</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> player_y = sqlite3_column_int(stmt_player_data, 1);</div>
<div class="line"><span class="lineno">  360</span>    setter(player_x, player_y);</div>
<div class="line"><span class="lineno">  361</span>    sqlite3_finalize(stmt_player_data);</div>
<div class="line"><span class="lineno">  362</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  363</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa85bcfad6111a8ba703fa55a8b8ff20e" name="aa85bcfad6111a8ba703fa55a8b8ff20e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa85bcfad6111a8ba703fa55a8b8ff20e">&#9670;&#160;</a></span>get_iso8601_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * get_iso8601_time </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current time in ISO 8601 format. </p>
<dl class="section return"><dt>Returns</dt><dd>The current time as a string in ISO 8601 format (must be freed by the caller) </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00194">194</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  194</span>                         {</div>
<div class="line"><span class="lineno">  195</span>    <span class="keyword">const</span> time_t now = time(NULL);</div>
<div class="line"><span class="lineno">  196</span>    <span class="keyword">const</span> <span class="keyword">struct </span>tm* tm = localtime(&amp;now);</div>
<div class="line"><span class="lineno">  197</span>    <span class="keywordtype">char</span> timestamp[TIMESTAMP_LENGTH];</div>
<div class="line"><span class="lineno">  198</span>    strftime(timestamp, <span class="keyword">sizeof</span>(timestamp), TIMESTAMP_FORMAT, tm);</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    <span class="keywordflow">return</span> strdup(timestamp);</div>
<div class="line"><span class="lineno">  201</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa93a439080a0ddfe9baed9d95c87db8d" name="aa93a439080a0ddfe9baed9d95c87db8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa93a439080a0ddfe9baed9d95c87db8d">&#9670;&#160;</a></span>get_latest_save_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int get_latest_save_id </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>Connection to the database </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The ID of the latest save </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00474">474</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  474</span>                                                             {</div>
<div class="line"><span class="lineno">  475</span>    <span class="comment">// Get the last game state ID</span></div>
<div class="line"><span class="lineno">  476</span>    sqlite3_stmt* stmt;</div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordtype">int</span> rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_LAST_GAME_STATE, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">  478</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  479</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  481</span>    }</div>
<div class="line"><span class="lineno">  482</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  483</span>    rc = sqlite3_step(stmt);</div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">if</span> (rc != SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  485</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  486</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  487</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  488</span>    }</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> game_state_id = sqlite3_column_int(stmt, 0);</div>
<div class="line"><span class="lineno">  491</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  492</span>    <span class="keywordflow">return</span> game_state_id;</div>
<div class="line"><span class="lineno">  493</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae37f61a14d87006756eb5c503b8934c2" name="ae37f61a14d87006756eb5c503b8934c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae37f61a14d87006756eb5c503b8934c2">&#9670;&#160;</a></span>get_save_infos()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structsave__info__container__t.html">save_info_container_t</a> * get_save_infos </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the info of the saves. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>A database connedtion. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A save_info_container containing the save info. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00365">365</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  365</span>                                                                            {</div>
<div class="line"><span class="lineno">  366</span>    sqlite3_stmt* stmt;</div>
<div class="line"><span class="lineno">  367</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_SELECT_ALL_GAME_STATES, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">  368</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  369</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  370</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  371</span>    }</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>    <span class="comment">// First, count the number of saves</span></div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordtype">int</span> save_count = 0;</div>
<div class="line"><span class="lineno">  375</span>    <span class="keywordflow">while</span> (sqlite3_step(stmt) == SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  376</span>        save_count++;</div>
<div class="line"><span class="lineno">  377</span>    }</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    <span class="comment">// Reset the statement to start from the beginning</span></div>
<div class="line"><span class="lineno">  380</span>    sqlite3_reset(stmt);</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>    <a class="code hl_struct" href="structsave__info__container__t.html">save_info_container_t</a>* save_infos = malloc(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="structsave__info__container__t.html">save_info_container_t</a>));</div>
<div class="line"><span class="lineno">  383</span>    <span class="keywordflow">if</span> (save_infos == NULL) {</div>
<div class="line"><span class="lineno">  384</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for save info container&quot;</span>);</div>
<div class="line"><span class="lineno">  385</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  386</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  387</span>    }</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordflow">if</span> (save_count == 0) {</div>
<div class="line"><span class="lineno">  390</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  391</span>        save_infos-&gt;count = 0;</div>
<div class="line"><span class="lineno">  392</span>        save_infos-&gt;infos = NULL;</div>
<div class="line"><span class="lineno">  393</span>        <span class="keywordflow">return</span> save_infos;</div>
<div class="line"><span class="lineno">  394</span>    }</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>    save_infos-&gt;count = save_count;</div>
<div class="line"><span class="lineno">  397</span>    save_infos-&gt;infos = malloc(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="structsave__info__t.html">save_info_t</a>) * save_count);</div>
<div class="line"><span class="lineno">  398</span>    <span class="keywordflow">if</span> (save_infos-&gt;infos == NULL) {</div>
<div class="line"><span class="lineno">  399</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for save infos&quot;</span>);</div>
<div class="line"><span class="lineno">  400</span>        free(save_infos);</div>
<div class="line"><span class="lineno">  401</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  402</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  403</span>    }</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span> </div>
<div class="line"><span class="lineno">  406</span>    <span class="comment">// Retrieve save information</span></div>
<div class="line"><span class="lineno">  407</span>    <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">while</span> (sqlite3_step(stmt) == SQLITE_ROW) {</div>
<div class="line"><span class="lineno">  409</span>        save_infos-&gt;infos[index].id = sqlite3_column_int(stmt, 0);</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>        snprintf(save_infos-&gt;infos[index].timestamp, TIMESTAMP_LENGTH, <span class="stringliteral">&quot;%s&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span>*) sqlite3_column_text(stmt, 1));</div>
<div class="line"><span class="lineno">  412</span>        snprintf(save_infos-&gt;infos[index].name, MAX_STRING_LENGTH, <span class="stringliteral">&quot;%s&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span>*) sqlite3_column_text(stmt, 2));</div>
<div class="line"><span class="lineno">  413</span>        index++;</div>
<div class="line"><span class="lineno">  414</span>    }</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordflow">return</span> save_infos;</div>
<div class="line"><span class="lineno">  419</span>}</div>
<div class="ttc" id="astructsave__info__container__t_html"><div class="ttname"><a href="structsave__info__container__t.html">save_info_container_t</a></div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8h_source.html#l00050">gamestate_database.h:50</a></div></div>
<div class="ttc" id="astructsave__info__t_html"><div class="ttname"><a href="structsave__info__t.html">save_info_t</a></div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8h_source.html#l00044">gamestate_database.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5939eebd6fcb052e5b1b2465bb97ee42" name="a5939eebd6fcb052e5b1b2465bb97ee42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5939eebd6fcb052e5b1b2465bb97ee42">&#9670;&#160;</a></span>save_game_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sqlite_int64 save_game_state </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdb__connection__t.html">db_connection_t</a> *</td>          <td class="paramname"><span class="paramname"><em>db_connection</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *</td>          <td class="paramname"><span class="paramname"><em>map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *</td>          <td class="paramname"><span class="paramname"><em>revealed_map</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>width</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>height</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structvector2d__t.html">vector2d_t</a></td>          <td class="paramname"><span class="paramname"><em>player</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>save_name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save the game state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_connection</td><td>A database connection. </td></tr>
    <tr><td class="paramname">map</td><td>The current map where nothing is hidden. </td></tr>
    <tr><td class="paramname">revealed_map</td><td>The current state of the revealed map. </td></tr>
    <tr><td class="paramname">width</td><td>The width of the map. </td></tr>
    <tr><td class="paramname">height</td><td>The hight of the map. </td></tr>
    <tr><td class="paramname">player</td><td>The player position. </td></tr>
    <tr><td class="paramname">save_name</td><td>A name for the save file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success none 0 on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gamestate__database_8c_source.html#l00031">31</a> of file <a class="el" href="gamestate__database_8c_source.html">gamestate_database.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   31</span>                                                                                                                                                                                               {</div>
<div class="line"><span class="lineno">   32</span>    <span class="comment">// Check if the database connection is open</span></div>
<div class="line"><span class="lineno">   33</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="database_8c.html#a064257e61ac38087e12fb9b950289768">db_is_open</a>(db_connection)) {</div>
<div class="line"><span class="lineno">   34</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Database connection is not open&quot;</span>);</div>
<div class="line"><span class="lineno">   35</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   36</span>    }</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">// Save the game state to the database into table game_state</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="comment">// Get the current time</span></div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordtype">char</span>* current_time = <a class="code hl_function" href="#aa85bcfad6111a8ba703fa55a8b8ff20e">get_iso8601_time</a>();</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">if</span> (current_time == NULL) {</div>
<div class="line"><span class="lineno">   42</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to get current time&quot;</span>);</div>
<div class="line"><span class="lineno">   43</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   44</span>    }</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>    <span class="comment">// Prepare the SQL statement</span></div>
<div class="line"><span class="lineno">   47</span>    sqlite3_stmt* stmt;</div>
<div class="line"><span class="lineno">   48</span>    <span class="keywordtype">int</span> rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_INSERT_GAME_STATE, -1, &amp;stmt, NULL);</div>
<div class="line"><span class="lineno">   49</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">   50</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">   51</span>        free(current_time);</div>
<div class="line"><span class="lineno">   52</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   53</span>    }</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">// Bind the current time to the statement</span></div>
<div class="line"><span class="lineno">   56</span>    rc = sqlite3_bind_text(stmt, 1, current_time, -1, SQLITE_TRANSIENT);</div>
<div class="line"><span class="lineno">   57</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">   58</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind time: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">   59</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">   60</span>        free(current_time);</div>
<div class="line"><span class="lineno">   61</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   62</span>    }</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>    <span class="comment">// We can free current_time after binding</span></div>
<div class="line"><span class="lineno">   65</span>    free(current_time);</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>    <span class="comment">// Bind the save name to the statement</span></div>
<div class="line"><span class="lineno">   68</span>    rc = sqlite3_bind_text(stmt, 2, save_name, -1, SQLITE_TRANSIENT);</div>
<div class="line"><span class="lineno">   69</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">   70</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind save name: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">   71</span>        sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">   72</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   73</span>    }</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">   76</span>    rc = sqlite3_step(stmt);</div>
<div class="line"><span class="lineno">   77</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">   78</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">   79</span>    }</div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">// Get the last inserted row ID</span></div>
<div class="line"><span class="lineno">   81</span>    <span class="keyword">const</span> sqlite3_int64 game_state_id = sqlite3_last_insert_rowid(db_connection-&gt;db);</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="comment">// Finalize the statement</span></div>
<div class="line"><span class="lineno">   84</span>    sqlite3_finalize(stmt);</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>    <span class="comment">// Save the map and revealed map to the database</span></div>
<div class="line"><span class="lineno">   87</span>    <span class="keywordtype">char</span>* map_json = <a class="code hl_function" href="#aa55051e28e3b3b3fba26bfe29c3222a1">arr2D_to_flat_json</a>(map, width, height);</div>
<div class="line"><span class="lineno">   88</span>    <span class="keywordtype">char</span>* revealed_map_json = <a class="code hl_function" href="#aa55051e28e3b3b3fba26bfe29c3222a1">arr2D_to_flat_json</a>(revealed_map, width, height);</div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">if</span> (map_json == NULL || revealed_map_json == NULL) {</div>
<div class="line"><span class="lineno">   90</span>        free(map_json);<span class="comment">// Safe to call on NULL</span></div>
<div class="line"><span class="lineno">   91</span>        free(revealed_map_json);</div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   93</span>    }</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    <span class="comment">// Prepare the SQL statement</span></div>
<div class="line"><span class="lineno">   96</span>    sqlite3_stmt* stmt_map;</div>
<div class="line"><span class="lineno">   97</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_INSERT_MAP_STATE, -1, &amp;stmt_map, NULL);</div>
<div class="line"><span class="lineno">   98</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">   99</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  100</span>        free(map_json);</div>
<div class="line"><span class="lineno">  101</span>        free(revealed_map_json);</div>
<div class="line"><span class="lineno">  102</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  103</span>    }</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>    <span class="comment">// Bind the map and revealed map to the statement</span></div>
<div class="line"><span class="lineno">  106</span>    rc = sqlite3_bind_text(stmt_map, 1, map_json, -1, SQLITE_TRANSIENT);</div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  108</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind map: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  109</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  110</span>        free(map_json);</div>
<div class="line"><span class="lineno">  111</span>        free(revealed_map_json);</div>
<div class="line"><span class="lineno">  112</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  113</span>    }</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    rc = sqlite3_bind_text(stmt_map, 2, revealed_map_json, -1, SQLITE_TRANSIENT);</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  117</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind revealed map: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  118</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  119</span>        free(map_json);</div>
<div class="line"><span class="lineno">  120</span>        free(revealed_map_json);</div>
<div class="line"><span class="lineno">  121</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  122</span>    }</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>    <span class="comment">// We can free JSON strings after binding</span></div>
<div class="line"><span class="lineno">  125</span>    free(map_json);</div>
<div class="line"><span class="lineno">  126</span>    free(revealed_map_json);</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    rc = sqlite3_bind_int(stmt_map, 3, height);</div>
<div class="line"><span class="lineno">  129</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  130</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind height: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  131</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  132</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  133</span>    }</div>
<div class="line"><span class="lineno">  134</span>    rc = sqlite3_bind_int(stmt_map, 4, width);</div>
<div class="line"><span class="lineno">  135</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  136</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind width: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  137</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  138</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  139</span>    }</div>
<div class="line"><span class="lineno">  140</span>    rc = sqlite3_bind_int64(stmt_map, 5, game_state_id);</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  142</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  143</span>        sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  145</span>    }</div>
<div class="line"><span class="lineno">  146</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  147</span>    rc = sqlite3_step(stmt_map);</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">  149</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  150</span>    }</div>
<div class="line"><span class="lineno">  151</span>    <span class="comment">// Finalize the statement</span></div>
<div class="line"><span class="lineno">  152</span>    sqlite3_finalize(stmt_map);</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>    <span class="comment">// Save the player position to the database</span></div>
<div class="line"><span class="lineno">  155</span>    sqlite3_stmt* stmt_player;</div>
<div class="line"><span class="lineno">  156</span>    rc = sqlite3_prepare_v2(db_connection-&gt;db, SQL_INSERT_PLAYER_STATE, -1, &amp;stmt_player, NULL);</div>
<div class="line"><span class="lineno">  157</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  158</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to prepare statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  159</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  160</span>    }</div>
<div class="line"><span class="lineno">  161</span>    <span class="comment">// Bind the player position to the statement</span></div>
<div class="line"><span class="lineno">  162</span>    rc = sqlite3_bind_int(stmt_player, 1, player.dx);</div>
<div class="line"><span class="lineno">  163</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  164</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind player x: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  165</span>        sqlite3_finalize(stmt_player);</div>
<div class="line"><span class="lineno">  166</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  167</span>    }</div>
<div class="line"><span class="lineno">  168</span>    rc = sqlite3_bind_int(stmt_player, 2, player.dy);</div>
<div class="line"><span class="lineno">  169</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  170</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind player y: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  171</span>        sqlite3_finalize(stmt_player);</div>
<div class="line"><span class="lineno">  172</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  173</span>    }</div>
<div class="line"><span class="lineno">  174</span>    rc = sqlite3_bind_int64(stmt_player, 3, game_state_id);</div>
<div class="line"><span class="lineno">  175</span>    <span class="keywordflow">if</span> (rc != SQLITE_OK) {</div>
<div class="line"><span class="lineno">  176</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to bind game state ID: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  177</span>        sqlite3_finalize(stmt_player);</div>
<div class="line"><span class="lineno">  178</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  179</span>    }</div>
<div class="line"><span class="lineno">  180</span>    <span class="comment">// Execute the statement</span></div>
<div class="line"><span class="lineno">  181</span>    rc = sqlite3_step(stmt_player);</div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">if</span> (rc != SQLITE_DONE) {</div>
<div class="line"><span class="lineno">  183</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(ERROR, <span class="stringliteral">&quot;GameState&quot;</span>, <span class="stringliteral">&quot;Failed to execute statement: %s&quot;</span>, sqlite3_errmsg(db_connection-&gt;db));</div>
<div class="line"><span class="lineno">  184</span>    }</div>
<div class="line"><span class="lineno">  185</span>    <span class="comment">// Finalize the statement</span></div>
<div class="line"><span class="lineno">  186</span>    sqlite3_finalize(stmt_player);</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">return</span> game_state_id;</div>
<div class="line"><span class="lineno">  188</span>}</div>
<div class="ttc" id="agamestate__database_8c_html_aa55051e28e3b3b3fba26bfe29c3222a1"><div class="ttname"><a href="#aa55051e28e3b3b3fba26bfe29c3222a1">arr2D_to_flat_json</a></div><div class="ttdeci">char * arr2D_to_flat_json(const int *arr, const int width, const int height)</div><div class="ttdoc">Convert a 2D array to a Json-Array.</div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8c_source.html#l00203">gamestate_database.c:203</a></div></div>
<div class="ttc" id="agamestate__database_8c_html_aa85bcfad6111a8ba703fa55a8b8ff20e"><div class="ttname"><a href="#aa85bcfad6111a8ba703fa55a8b8ff20e">get_iso8601_time</a></div><div class="ttdeci">char * get_iso8601_time()</div><div class="ttdoc">Get the current time in ISO 8601 format.</div><div class="ttdef"><b>Definition</b> <a href="gamestate__database_8c_source.html#l00194">gamestate_database.c:194</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_803ee67260c130b45d29089798491ab2.html">database</a></li><li class="navelem"><a href="dir_f19cf67b5895214871ced27260ec3b9b.html">game</a></li><li class="navelem"><a href="gamestate__database_8c.html">gamestate_database.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
