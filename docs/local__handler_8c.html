<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DungeonCrawl: src/local/local_handler.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DungeonCrawl
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('local__handler_8c.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">local_handler.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements localization for the game.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="local__handler_8h_source.html">local_handler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="logger_8h_source.html">../logging/logger.h</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div>
<p><a href="local__handler_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:observer_5Fnode" id="r_observer_5Fnode"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structobserver__node.html">observer_node</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a837df2c29aacf37cb96c2b65acb312a6" id="r_a837df2c29aacf37cb96c2b65acb312a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a837df2c29aacf37cb96c2b65acb312a6">PATH_SEP</a>&#160;&#160;&#160;&quot;/&quot;</td></tr>
<tr class="memitem:a55176447671733dbd21c6ae879523eea" id="r_a55176447671733dbd21c6ae879523eea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a55176447671733dbd21c6ae879523eea">LOCAL_DIRECTORY</a>&#160;&#160;&#160;&quot;resources/local&quot;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-typedef-members" class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:aeba54b786584795b4ae511e920ccca49" id="r_aeba54b786584795b4ae511e920ccca49"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structobserver__node.html">observer_node</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeba54b786584795b4ae511e920ccca49">observer_node_t</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab04b232544b0352a2de6e954cd5235de" id="r_ab04b232544b0352a2de6e954cd5235de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab04b232544b0352a2de6e954cd5235de">init_local_handler</a> (const local_lang_t lang)</td></tr>
<tr class="memdesc:ab04b232544b0352a2de6e954cd5235de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the local language handler by setting up the language and opening the corresponding resource file.  <br /></td></tr>
<tr class="memitem:a56c6d5e9fa7b72411ddbb39a37ebbaaf" id="r_a56c6d5e9fa7b72411ddbb39a37ebbaaf"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a56c6d5e9fa7b72411ddbb39a37ebbaaf">get_local_string</a> (const char *key)</td></tr>
<tr class="memdesc:a56c6d5e9fa7b72411ddbb39a37ebbaaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the localized string for the given key.  <br /></td></tr>
<tr class="memitem:a6e74532281d4166e72427bf99287ba82" id="r_a6e74532281d4166e72427bf99287ba82"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6e74532281d4166e72427bf99287ba82">set_language</a> (const local_lang_t lang)</td></tr>
<tr class="memdesc:a6e74532281d4166e72427bf99287ba82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the current language for the local handler and updates all registered observers.  <br /></td></tr>
<tr class="memitem:a2ee20b5ced1851dfa72bbdef34fa1e33" id="r_a2ee20b5ced1851dfa72bbdef34fa1e33"><td class="memItemLeft" align="right" valign="top">local_lang_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2ee20b5ced1851dfa72bbdef34fa1e33">get_language</a> (void)</td></tr>
<tr class="memdesc:a2ee20b5ced1851dfa72bbdef34fa1e33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the currently set language of the local handler.  <br /></td></tr>
<tr class="memitem:aba89dc368496a4c4daad4102bb508a0e" id="r_aba89dc368496a4c4daad4102bb508a0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aba89dc368496a4c4daad4102bb508a0e">observe_local</a> (void(*update_func)(void))</td></tr>
<tr class="memdesc:aba89dc368496a4c4daad4102bb508a0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers an observer function to be notified of updates from the local handler.  <br /></td></tr>
<tr class="memitem:a3172ed29ce8bc435a786e295a9d51fb4" id="r_a3172ed29ce8bc435a786e295a9d51fb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3172ed29ce8bc435a786e295a9d51fb4">shutdown_local_handler</a> (void)</td></tr>
<tr class="memdesc:a3172ed29ce8bc435a786e295a9d51fb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shut down the local language handler by releasing resources and closing the resource file.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a27ad8ce98bebf37859d424e0faedbba3" id="r_a27ad8ce98bebf37859d424e0faedbba3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structobserver__node.html">observer_node_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a27ad8ce98bebf37859d424e0faedbba3">observer_list</a> = NULL</td></tr>
<tr class="memitem:a79a0bab456c935315de1b43f2870e4a5" id="r_a79a0bab456c935315de1b43f2870e4a5"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a79a0bab456c935315de1b43f2870e4a5">local_file</a> = NULL</td></tr>
<tr class="memitem:ad12c467ecc161f9eabe5b9ca274e508d" id="r_ad12c467ecc161f9eabe5b9ca274e508d"><td class="memItemLeft" align="right" valign="top">local_lang_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad12c467ecc161f9eabe5b9ca274e508d">current_lang</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements localization for the game. </p>

<p class="definition">Definition in file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a55176447671733dbd21c6ae879523eea" name="a55176447671733dbd21c6ae879523eea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55176447671733dbd21c6ae879523eea">&#9670;&#160;</a></span>LOCAL_DIRECTORY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCAL_DIRECTORY&#160;&#160;&#160;&quot;resources/local&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00018">18</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
<a id="a837df2c29aacf37cb96c2b65acb312a6" name="a837df2c29aacf37cb96c2b65acb312a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a837df2c29aacf37cb96c2b65acb312a6">&#9670;&#160;</a></span>PATH_SEP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PATH_SEP&#160;&#160;&#160;&quot;/&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00017">17</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
<a name="doc-typedef-members" id="doc-typedef-members"></a><h2 id="header-doc-typedef-members" class="groupheader">Typedef Documentation</h2>
<a id="aeba54b786584795b4ae511e920ccca49" name="aeba54b786584795b4ae511e920ccca49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeba54b786584795b4ae511e920ccca49">&#9670;&#160;</a></span>observer_node_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structobserver__node.html">observer_node</a> <a class="el" href="structobserver__node.html">observer_node_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00021">21</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a2ee20b5ced1851dfa72bbdef34fa1e33" name="a2ee20b5ced1851dfa72bbdef34fa1e33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ee20b5ced1851dfa72bbdef34fa1e33">&#9670;&#160;</a></span>get_language()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">local_lang_t get_language </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the currently set language of the local handler. </p>
<p>This function returns the current language configured for the local handler. If the local handler is not initialized, it logs a warning message and defaults the language to English.</p>
<dl class="section return"><dt>Returns</dt><dd>the current language as a value of local_lang_t, or LANGE_EN if the handler is not initialized </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00116">116</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  116</span>                                {</div>
<div class="line"><span class="lineno">  117</span>    <span class="keywordflow">if</span> (local_file == NULL) {</div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(WARNING, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Local handler is not initialized.&quot;</span>);</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">return</span> LANGE_EN;<span class="comment">// default to English if not initialized</span></div>
<div class="line"><span class="lineno">  120</span>    }</div>
<div class="line"><span class="lineno">  121</span>    <span class="keywordflow">return</span> current_lang;</div>
<div class="line"><span class="lineno">  122</span>}</div>
<div class="ttc" id="alogger_8c_html_aa70df4f70b7969a40b70fda659005550"><div class="ttname"><a href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a></div><div class="ttdeci">void log_msg(const log_level_t level, const char *module, const char *format,...)</div><div class="ttdoc">Logs a formatted message with a specified log level and module.</div><div class="ttdef"><b>Definition</b> <a href="logger_8c_source.html#l00246">logger.c:246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a56c6d5e9fa7b72411ddbb39a37ebbaaf" name="a56c6d5e9fa7b72411ddbb39a37ebbaaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56c6d5e9fa7b72411ddbb39a37ebbaaf">&#9670;&#160;</a></span>get_local_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * get_local_string </td>
          <td>(</td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the localized string for the given key. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>the key for the localized string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the localized string, if the key is not found, returns the key itself </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The caller must free the returned string. </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00054">54</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span>                                        {</div>
<div class="line"><span class="lineno">   55</span>    RETURN_WHEN_NULL(local_file, NULL, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Local handler is not initialized.&quot;</span>);</div>
<div class="line"><span class="lineno">   56</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> line[512];</div>
<div class="line"><span class="lineno">   57</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> key_len = strlen(key);</div>
<div class="line"><span class="lineno">   58</span> </div>
<div class="line"><span class="lineno">   59</span>    rewind(local_file);</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>    <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), local_file)) {</div>
<div class="line"><span class="lineno">   62</span>        <span class="comment">//if the line is empty or a comment, skip it</span></div>
<div class="line"><span class="lineno">   63</span>        <span class="keywordflow">if</span> (line[0] == <span class="charliteral">&#39;\n&#39;</span> || line[0] == <span class="charliteral">&#39;#&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>        <span class="keywordflow">if</span> (line[key_len] == <span class="charliteral">&#39;=&#39;</span>) {</div>
<div class="line"><span class="lineno">   66</span>            <span class="keywordflow">if</span> (strncmp(line, key, key_len) == 0) {</div>
<div class="line"><span class="lineno">   67</span>                <span class="comment">// get the starting position</span></div>
<div class="line"><span class="lineno">   68</span>                <span class="keywordtype">char</span>* start = strchr(line, <span class="charliteral">&#39;&quot;&#39;</span>);</div>
<div class="line"><span class="lineno">   69</span>                <span class="keywordflow">if</span> (!start) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>                <span class="comment">// get the end position</span></div>
<div class="line"><span class="lineno">   72</span>                <span class="keywordtype">char</span>* end = strchr(start + 1, <span class="charliteral">&#39;&quot;&#39;</span>);</div>
<div class="line"><span class="lineno">   73</span>                <span class="keywordflow">if</span> (!end) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span>                <span class="keyword">const</span> <span class="keywordtype">size_t</span> len = end - (start + 1);</div>
<div class="line"><span class="lineno">   76</span>                <span class="keywordtype">char</span>* result = (<span class="keywordtype">char</span>*) malloc(len + 1);</div>
<div class="line"><span class="lineno">   77</span>                RETURN_WHEN_NULL(result, NULL, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for local string.&quot;</span>);</div>
<div class="line"><span class="lineno">   78</span> </div>
<div class="line"><span class="lineno">   79</span>                snprintf(result, len + 1, <span class="stringliteral">&quot;%s&quot;</span>, start + 1);</div>
<div class="line"><span class="lineno">   80</span>                <span class="keywordflow">return</span> result;</div>
<div class="line"><span class="lineno">   81</span>            }</div>
<div class="line"><span class="lineno">   82</span>        }</div>
<div class="line"><span class="lineno">   83</span>    }</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span>    <span class="keywordflow">return</span> strdup(key);</div>
<div class="line"><span class="lineno">   86</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab04b232544b0352a2de6e954cd5235de" name="ab04b232544b0352a2de6e954cd5235de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab04b232544b0352a2de6e954cd5235de">&#9670;&#160;</a></span>init_local_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_local_handler </td>
          <td>(</td>
          <td class="paramtype">local_lang_t</td>          <td class="paramname"><span class="paramname"><em>lang</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the local language handler by setting up the language and opening the corresponding resource file. </p>
<p>This function initializes the handler to use the specified language. It opens the associated language file based on a predefined mapping and prepares the observer list for updates. If the handler is already initialized, a warning is logged and initialization is skipped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lang</td><td>the language to be set for the local handler </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, or 1 if the resource file cannot be opened </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00032">32</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   32</span>                                                {</div>
<div class="line"><span class="lineno">   33</span>    <span class="keywordflow">if</span> (local_file != NULL) {</div>
<div class="line"><span class="lineno">   34</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(WARNING, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Local handler is already initialized.&quot;</span>);</div>
<div class="line"><span class="lineno">   35</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   36</span>    }</div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="line"><span class="lineno">   38</span>    current_lang = lang;</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordtype">char</span> rel_path[128];</div>
<div class="line"><span class="lineno">   41</span>    snprintf(rel_path, <span class="keyword">sizeof</span>(rel_path), <span class="stringliteral">&quot;%s&quot;</span> PATH_SEP <span class="stringliteral">&quot;%s&quot;</span>, LOCAL_DIRECTORY, local_file_mapping[lang].file_name);</div>
<div class="line"><span class="lineno">   42</span> </div>
<div class="line"><span class="lineno">   43</span>    local_file = fopen(rel_path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">   44</span>    RETURN_WHEN_NULL(local_file, 1, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Failed to open local file.&quot;</span>);</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>    observer_list = malloc(<span class="keyword">sizeof</span>(observer_node_t));</div>
<div class="line"><span class="lineno">   47</span>    RETURN_WHEN_NULL(observer_list, 1, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for observer list.&quot;</span>);</div>
<div class="line"><span class="lineno">   48</span> </div>
<div class="line"><span class="lineno">   49</span>    observer_list-&gt;update_func = NULL;</div>
<div class="line"><span class="lineno">   50</span>    observer_list-&gt;next = NULL;</div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   52</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aba89dc368496a4c4daad4102bb508a0e" name="aba89dc368496a4c4daad4102bb508a0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba89dc368496a4c4daad4102bb508a0e">&#9670;&#160;</a></span>observe_local()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void observe_local </td>
          <td>(</td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>update_func&#160;</em></span>)(void)</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers an observer function to be notified of updates from the local handler. </p>
<p>This function adds a new observer to the observer list maintained by the local handler. The observer function will be invoked when relevant updates occur. The observer handler must be initialized before calling this function. If the observer function or handler is invalid, the registration is aborted, and an error is logged.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">update_func</td><td>the observer function to be registered for receiving updates </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00124">124</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  124</span>                                              {</div>
<div class="line"><span class="lineno">  125</span>    RETURN_WHEN_NULL(local_file, , <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Local handler is not initialized.&quot;</span>);</div>
<div class="line"><span class="lineno">  126</span>    RETURN_WHEN_NULL(update_func, , <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Invalid observer function.&quot;</span>);</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    observer_node_t* new_node = malloc(<span class="keyword">sizeof</span>(observer_node_t));</div>
<div class="line"><span class="lineno">  129</span>    RETURN_WHEN_NULL(new_node, , <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Failed to allocate memory for observer node.&quot;</span>);</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    new_node-&gt;update_func = update_func;</div>
<div class="line"><span class="lineno">  132</span>    new_node-&gt;next = NULL;</div>
<div class="line"><span class="lineno">  133</span>    observer_node_t* current = observer_list;</div>
<div class="line"><span class="lineno">  134</span>    <span class="keywordflow">while</span> (current-&gt;next != NULL) {</div>
<div class="line"><span class="lineno">  135</span>        current = current-&gt;next;</div>
<div class="line"><span class="lineno">  136</span>    }</div>
<div class="line"><span class="lineno">  137</span>    current-&gt;next = new_node;</div>
<div class="line"><span class="lineno">  138</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e74532281d4166e72427bf99287ba82" name="a6e74532281d4166e72427bf99287ba82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e74532281d4166e72427bf99287ba82">&#9670;&#160;</a></span>set_language()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int set_language </td>
          <td>(</td>
          <td class="paramtype">local_lang_t</td>          <td class="paramname"><span class="paramname"><em>lang</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the current language for the local handler and updates all registered observers. </p>
<p>This function updates the current language setting which determines the active language file to be used. It attempts to close the current language file, opens the new associated language resource file, and subsequently notifies the observer list by invoking their respective update functions. The function ensures the validity of the input language and handles errors related to file operations or uninitialized states.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lang</td><td>the language to be set (e.g., LANGE_EN, LANGE_DE) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, 1 if the specified language file cannot be opened, or 2 if the handler is not initialized or the language is invalid </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00089">89</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   89</span>                                          {</div>
<div class="line"><span class="lineno">   90</span>    RETURN_WHEN_NULL(local_file, 2, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Local handler is not initialized.&quot;</span>);</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>    <span class="keywordflow">if</span> (lang &gt;= MAX_LANG) {</div>
<div class="line"><span class="lineno">   93</span>        <a class="code hl_function" href="logger_8c.html#aa70df4f70b7969a40b70fda659005550">log_msg</a>(WARNING, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Invalid language: %d.&quot;</span>, lang);</div>
<div class="line"><span class="lineno">   94</span>        <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">   95</span>    }</div>
<div class="line"><span class="lineno">   96</span>    current_lang = lang;</div>
<div class="line"><span class="lineno">   97</span>    fclose(local_file);</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordtype">char</span> rel_path[128];</div>
<div class="line"><span class="lineno">  100</span>    snprintf(rel_path, <span class="keyword">sizeof</span>(rel_path), <span class="stringliteral">&quot;%s&quot;</span> PATH_SEP <span class="stringliteral">&quot;%s&quot;</span>, LOCAL_DIRECTORY, local_file_mapping[lang].file_name);</div>
<div class="line"><span class="lineno">  101</span>    local_file = fopen(rel_path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno">  102</span>    RETURN_WHEN_NULL(local_file, 1, <span class="stringliteral">&quot;Local&quot;</span>, <span class="stringliteral">&quot;Failed to open local file.&quot;</span>);</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>    <span class="comment">// go through the observer list</span></div>
<div class="line"><span class="lineno">  105</span>    <span class="keyword">const</span> observer_node_t* current = observer_list;</div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordflow">while</span> (current != NULL) {</div>
<div class="line"><span class="lineno">  107</span>        <span class="keywordflow">if</span> (current-&gt;update_func != NULL) {</div>
<div class="line"><span class="lineno">  108</span>            current-&gt;update_func();<span class="comment">//call the observer function</span></div>
<div class="line"><span class="lineno">  109</span>        }</div>
<div class="line"><span class="lineno">  110</span>        current = current-&gt;next;</div>
<div class="line"><span class="lineno">  111</span>    }</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  114</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3172ed29ce8bc435a786e295a9d51fb4" name="a3172ed29ce8bc435a786e295a9d51fb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3172ed29ce8bc435a786e295a9d51fb4">&#9670;&#160;</a></span>shutdown_local_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void shutdown_local_handler </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shut down the local language handler by releasing resources and closing the resource file. </p>
<p>This function deallocates all memory used by the observer list tied to the local handler. It ensures that all dynamically allocated observer nodes are freed to prevent memory leaks. Additionally, it closes the language resource file if it was previously opened.</p>
<p>Proper usage of this function ensures a clean shutdown of the local language handler by releasing occupied resources and leaving no lingering operations. </p>

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00140">140</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  140</span>                                  {</div>
<div class="line"><span class="lineno">  141</span>    <span class="comment">// free the observer list</span></div>
<div class="line"><span class="lineno">  142</span>    observer_node_t* current = observer_list;</div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">while</span> (current != NULL) {</div>
<div class="line"><span class="lineno">  144</span>        observer_node_t* next = current-&gt;next;</div>
<div class="line"><span class="lineno">  145</span>        free(current);</div>
<div class="line"><span class="lineno">  146</span>        current = next;</div>
<div class="line"><span class="lineno">  147</span>    }</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>    <span class="keywordflow">if</span> (local_file != NULL) fclose(local_file);</div>
<div class="line"><span class="lineno">  150</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="ad12c467ecc161f9eabe5b9ca274e508d" name="ad12c467ecc161f9eabe5b9ca274e508d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad12c467ecc161f9eabe5b9ca274e508d">&#9670;&#160;</a></span>current_lang</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">local_lang_t current_lang</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00030">30</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
<a id="a79a0bab456c935315de1b43f2870e4a5" name="a79a0bab456c935315de1b43f2870e4a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79a0bab456c935315de1b43f2870e4a5">&#9670;&#160;</a></span>local_file</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* local_file = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00029">29</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
<a id="a27ad8ce98bebf37859d424e0faedbba3" name="a27ad8ce98bebf37859d424e0faedbba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27ad8ce98bebf37859d424e0faedbba3">&#9670;&#160;</a></span>observer_list</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structobserver__node.html">observer_node_t</a>* observer_list = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="local__handler_8c_source.html#l00028">28</a> of file <a class="el" href="local__handler_8c_source.html">local_handler.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="dir_c7eb4fb5b3548168e57f75b63628aa56.html">local</a></li><li class="navelem"><a href="local__handler_8c.html">local_handler.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
